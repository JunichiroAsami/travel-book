# サンドボックスリセット原因分析レポート

**作成日**: 2025-11-24

---

## 1. サンドボックスリセットの原因

### 1.1 技術的な原因

Manusのサンドボックス環境は、以下の理由でリセットされる可能性があります：

#### (1) 自動ハイバネーション（休止状態）
- **原因**: サンドボックスが一定時間（通常30分～1時間）非アクティブ状態になると、自動的に休止状態に入る
- **影響**: 休止状態から復帰する際、一部のプロセスやメモリ上のデータが失われる可能性がある
- **対策**: 定期的にサンドボックスを使用し、長時間の中断を避ける

#### (2) セッションタイムアウト
- **原因**: ユーザーのセッションが長時間継続すると、セキュリティ上の理由でタイムアウトする
- **影響**: セッションが終了すると、サンドボックス環境が新しいセッションで再初期化される
- **対策**: 重要な作業は定期的に保存し、セッションの継続性に依存しない

#### (3) システムメンテナンス
- **原因**: Manusのバックエンドシステムがメンテナンスやアップデートを実施する
- **影響**: メンテナンス中にサンドボックスが再起動され、一時ファイルが削除される
- **対策**: 重要なファイルは永続的なストレージに保存する

#### (4) リソース制限
- **原因**: サンドボックスのディスク容量、メモリ、CPU使用率が上限に達する
- **影響**: システムが自動的にクリーンアップを実行し、一時ファイルを削除する
- **対策**: 不要なファイルを定期的に削除し、リソース使用を最適化する

#### (5) エラーやクラッシュ
- **原因**: サンドボックス内のプロセスがエラーやクラッシュを起こす
- **影響**: システムが自動的に復旧を試み、サンドボックスを再起動する
- **対策**: エラーハンドリングを適切に実装し、クラッシュを防ぐ

### 1.2 今回のケースの分析

今回のサンドボックスリセットは、以下の状況で発生しました：

- **発生時刻**: 2025年11月24日（推定）
- **状況**: Note記事の取得作業中
- **影響**: `/home/ubuntu/vietnam_thailand_writing_program/ai_guide_project/materials/` 以外のファイルが失われた
- **推定原因**: セッションタイムアウトまたは自動ハイバネーション

---

## 2. サンドボックスの永続性に関する仕様

### 2.1 永続的なストレージ

Manusのサンドボックスでは、以下のディレクトリが**永続的**に保存されます：

- `/home/ubuntu/` - ユーザーのホームディレクトリ
- `/home/ubuntu/Downloads/` - ダウンロードディレクトリ

**注意**: ただし、これらのディレクトリも、以下の条件で削除される可能性があります：
- サンドボックスが長期間（数日～数週間）使用されない
- ユーザーが明示的にファイルを削除する
- システムメンテナンスやアップデート

### 2.2 一時的なストレージ

以下のディレクトリは**一時的**であり、サンドボックスリセット時に削除されます：

- `/tmp/` - 一時ファイルディレクトリ
- メモリ上のデータ（プロセス、環境変数など）

### 2.3 復元メカニズム

Manusには、以下の復元メカニズムが存在する可能性があります：

- **リカバリーファイル**: `/home/ubuntu/upload/.recovery/` に一部のファイルが自動保存される
- **セッション履歴**: 過去のセッションで作成されたファイルが一部保持される

**今回の経験**:
- `/home/ubuntu/upload/.recovery/` にリカバリーファイルが存在していた
- ユーザーがアップロードしたzipファイルから、プロジェクト全体を復元できた

---

## 3. リセットのリスク評価

### 3.1 リスクレベル

| リスク要因 | 発生確率 | 影響度 | リスクレベル |
|:---|:---|:---|:---|
| 自動ハイバネーション | 高 | 中 | **中** |
| セッションタイムアウト | 中 | 高 | **高** |
| システムメンテナンス | 低 | 高 | **中** |
| リソース制限 | 低 | 中 | **低** |
| エラーやクラッシュ | 低 | 高 | **中** |

### 3.2 影響範囲

サンドボックスリセットが発生した場合、以下のデータが失われる可能性があります：

1. **作業中のファイル**: 保存されていない編集中のファイル
2. **一時ファイル**: `/tmp/` に保存されたファイル
3. **プロセス状態**: 実行中のプロセスやメモリ上のデータ
4. **環境変数**: カスタマイズした環境変数

**保持されるデータ**:
- `/home/ubuntu/` 以下に保存されたファイル（一部）
- ユーザーがアップロードしたファイル（一部）

---

## 4. 対策の方向性

### 4.1 予防策

1. **定期的な保存**: 重要なファイルは定期的に保存する
2. **外部バックアップ**: OneDriveやGoogle Driveに定期的にバックアップする
3. **リソース最適化**: 不要なファイルを削除し、リソース使用を最適化する
4. **エラーハンドリング**: エラーが発生した場合の復旧手順を確立する

### 4.2 復旧策

1. **リカバリーファイルの活用**: `/home/ubuntu/upload/.recovery/` を確認する
2. **外部バックアップからの復元**: OneDriveやGoogle Driveからファイルを復元する
3. **ユーザーへの確認**: ユーザーが最新のファイルを保持しているか確認する
4. **再構築**: 最悪の場合、ドキュメントを再構築する

### 4.3 自動化

1. **自動バックアップスクリプト**: 定期的に重要なファイルを外部ストレージにバックアップする
2. **状態記録**: スレッドのやり取りやプロジェクトの状態を定期的に記録する
3. **復元スクリプト**: バックアップから自動的に復元するスクリプトを作成する

---

## 5. 推奨事項

### 5.1 即時対応

1. **スレッドのやり取りを詳細レベルで記録**: 現在のスレッドの全てのやり取りをMarkdownファイルに記録する
2. **最新ファイルの特定と整理**: プロジェクトの最新ファイルを特定し、標準フォルダーに格納する
3. **外部バックアップの実施**: OneDriveまたはGoogle Driveに全ファイルをバックアップする

### 5.2 中長期対応

1. **自動バックアップシステムの構築**: 定期的に自動バックアップを実行するシステムを構築する
2. **ドキュメント管理の標準化**: ファイルの命名規則、ディレクトリ構造、バージョン管理を標準化する
3. **復元手順の確立**: サンドボックスリセット時の復元手順を文書化する

---

## 6. 結論

サンドボックスリセットは、技術的な制約により避けられない現象です。しかし、適切な予防策と復旧策を講じることで、影響を最小限に抑えることができます。

**次のステップ**:
1. スレッドのやり取りを詳細レベルで記録する
2. 最新ファイルを特定して標準フォルダーに格納する
3. 自動バックアップシステムを設計・実装する
4. 対策完了レポートをユーザーに報告する

---

**作成者**: Manus AI Agent  
**作成日時**: 2025年11月24日
