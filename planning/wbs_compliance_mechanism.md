# WBS準拠を保証する仕組み

作成日：2025-11-25

## 1. 問題の本質

**問題**: WBSを作成しても、実際の作業で準拠しなければ意味がない。

**原因**:
1. WBSの存在を忘れる
2. WBSの内容を確認しない
3. WBSとの照合を実施しない
4. WBS違反を検出する仕組みがない

**結果**: 第5章の執筆で、詳細設計書を確認せずに執筆を開始し、重大な齟齬が発生

---

## 2. WBS準拠を保証する仕組みの設計

### 2-1. 基本方針

WBS準拠を保証するために、以下の3つの仕組みを導入します:

1. **事前チェックリスト**: 各タスク開始前に、WBSで定義されたインプットを確認
2. **自動検証ツール**: 各タスク完了後に、WBSで定義された品質基準を自動検証
3. **SOP（標準作業手順書）**: 各タスクの実施手順を明文化し、WBS準拠を強制

### 2-2. 3層の防御機構

```
【第1層】事前チェックリスト
  ↓ タスク開始前にインプットを確認
  
【第2層】SOP（標準作業手順書）
  ↓ タスク実施中に手順を遵守
  
【第3層】自動検証ツール
  ↓ タスク完了後に品質基準を自動検証
```

---

## 3. 事前チェックリスト

### 3-1. 目的

各タスク開始前に、WBSで定義されたインプットが揃っているかを確認し、WBS違反を防ぐ。

### 3-2. チェックリストの構成

各タスクごとに、以下の項目をチェックします:

1. **タスク名**: WBS IDとタスク名を確認
2. **前タスクの完了**: 前タスクが完了しているか確認
3. **インプットの確認**: WBSで定義されたインプットが揃っているか確認
4. **品質基準の確認**: WBSで定義された品質基準を確認

### 3-3. 第5章執筆の事前チェックリスト（例）

#### 3.5.3.0 詳細設計書の確認

| 項目 | 確認内容 | 確認結果 |
|------|---------|---------|
| **タスク名** | 3.5.3.0 詳細設計書の確認 | ✅ |
| **前タスク** | 3.0.9 修正・確定 が完了しているか | ✅ / ❌ |
| **インプット1** | 詳細設計書最終版（chapter5_detailed_design_v3.md）が存在するか | ✅ / ❌ |
| **品質基準** | 章のタイトル、構成、分量、各節の内容、実例の配置を確認 | ✅ / ❌ |

#### 3.5.3.1 プロンプト作成

| 項目 | 確認内容 | 確認結果 |
|------|---------|---------|
| **タスク名** | 3.5.3.1 プロンプト作成 | ✅ |
| **前タスク** | 3.5.3.0 詳細設計書の確認 が完了しているか | ✅ / ❌ |
| **インプット1** | 書籍企画書が存在するか | ✅ / ❌ |
| **インプット2** | 詳細設計書最終版が存在するか | ✅ / ❌ |
| **インプット3** | 章ごとの素材ファイルが存在するか | ✅ / ❌ |
| **インプット4** | 汎用ドキュメント作成ガイドラインが存在するか | ✅ / ❌ |
| **インプット5** | プロジェクト専用ガイドラインが存在するか | ✅ / ❌ |
| **品質基準** | 企画書・詳細設計書・素材ファイル・ガイドラインに基づく | ✅ / ❌ |

### 3-4. チェックリストの実装

**方法1**: Markdownファイルとして作成し、手動でチェック

**方法2**: Pythonスクリプトとして作成し、自動でチェック

**推奨**: 方法2（Pythonスクリプト）を採用し、以下の機能を実装:
1. WBS v9から各タスクのインプットを自動抽出
2. インプットファイルの存在確認
3. チェック結果をMarkdownファイルとして出力
4. すべてのチェックが✅でない場合は、タスク開始を中止

---

## 4. 自動検証ツール

### 4-1. 目的

各タスク完了後に、WBSで定義された品質基準を自動検証し、WBS違反を検出する。

### 4-2. 検証ツールの構成

各タスクごとに、以下の項目を自動検証します:

1. **アウトプットの存在確認**: WBSで定義されたアウトプットが生成されているか
2. **品質基準の検証**: WBSで定義された品質基準を満たしているか
3. **詳細設計書との照合**: 詳細設計書で定義された内容と一致しているか

### 4-3. 第5章執筆の自動検証ツール（例）

#### 3.5.3.2 Geminiで生成（初稿）

**検証項目**:
1. ✅ 初稿ファイル（chapter5_draft_v1.md）が存在するか
2. ✅ 初稿がガイドラインに準拠しているか
   - 引用ブロック形式を使用しているか
   - 専門用語に説明を追加しているか
3. ✅ 初稿が詳細設計書と一致しているか
   - 章のタイトルが一致しているか
   - 章の構成（節の数、各節のタイトル）が一致しているか
   - 分量が基準を満たしているか（±20%の範囲内）

#### 3.5.4.6 7観点レビュー

**検証項目**:
1. ✅ レビュー報告書3が存在するか
2. ✅ 7観点すべてがレビューされているか
   - トレーサビリティ
   - 論理性
   - 読みやすさ
   - 実用性
   - 独自性
   - 文体の一貫性
   - **詳細設計書との照合**
3. ✅ 詳細設計書との照合が実施されているか
   - 章のタイトルの照合
   - 章の構成の照合
   - 分量の照合
   - 各節の内容の照合
   - 実例の配置の照合
   - 各節のまとめの有無の確認

### 4-4. 検証ツールの実装

**Pythonスクリプトとして実装**:

```python
# 例: 詳細設計書との照合ツール
def verify_chapter_against_design(chapter_file, design_file):
    """
    章のドラフトを詳細設計書と照合する
    """
    # 1. 章のタイトルの照合
    # 2. 章の構成の照合
    # 3. 分量の照合
    # 4. 各節の内容の照合
    # 5. 実例の配置の照合
    # 6. 各節のまとめの有無の確認
    
    # 検証結果をレポートとして出力
    return verification_report
```

**機能**:
1. 詳細設計書を解析し、期待される内容を抽出
2. ドラフトを解析し、実際の内容を抽出
3. 期待される内容と実際の内容を照合
4. 齟齬を検出し、レポートとして出力
5. すべての検証が✅でない場合は、警告を表示

---

## 5. SOP（標準作業手順書）

### 5-1. 目的

各タスクの実施手順を明文化し、WBS準拠を強制する。

### 5-2. SOPの構成

各タスクごとに、以下の項目を記載します:

1. **タスク名**: WBS IDとタスク名
2. **目的**: タスクの目的
3. **前提条件**: 前タスクの完了、インプットの確認
4. **実施手順**: ステップバイステップの手順
5. **品質基準**: WBSで定義された品質基準
6. **完了条件**: タスク完了の判断基準
7. **次タスク**: 次に実施するタスク

### 5-3. 第5章執筆のSOP（例）

#### SOP-3.5.3.0: 詳細設計書の確認

**1. タスク名**: 3.5.3.0 詳細設計書の確認

**2. 目的**: 詳細設計書の内容を確認し、執筆に必要な情報を把握する

**3. 前提条件**:
- ✅ 3.0.9 修正・確定 が完了している
- ✅ 詳細設計書最終版（chapter5_detailed_design_v3.md）が存在する

**4. 実施手順**:

**ステップ1**: 事前チェックリストを実行
```bash
python3 /home/ubuntu/ai_travel_book_project/tools/pre_task_checklist.py 3.5.3.0
```

**ステップ2**: 詳細設計書を読む
```bash
cat /home/ubuntu/ai_travel_book_project/planning/detailed_designs/chapter5_detailed_design_v3.md
```

**ステップ3**: 確認チェックリストを作成
- ✅ 章のタイトルを確認: 「第5章：冷静な危機管理コンサルタント」
- ✅ 章の構成を確認: 4つの節（健康トラブル、金銭トラブル、サービストラブル、物損トラブル）
- ✅ 想定文字数を確認: 10,000～12,000文字
- ✅ 各節の内容を確認: 各節2,500～3,000文字
- ✅ 実例の配置を確認: LOG019は第1節、LOG050は第3節、など
- ✅ 各節のまとめを確認: 各節に200～300文字のまとめが必要

**ステップ4**: 確認チェックリストを保存
```bash
cat > /home/ubuntu/ai_travel_book_project/checklists/chapter5_design_checklist.md << 'EOF'
# 第5章 詳細設計書 確認チェックリスト

## 章のタイトル
- 第5章：冷静な危機管理コンサルタント

## 章の構成
1. 第1節：健康トラブルへの対応
2. 第2節：金銭トラブルへの対応
3. 第3節：サービストラブルへの対応
4. 第4節：物損トラブルへの対応

## 想定文字数
- 全体: 10,000～12,000文字
- 各節: 2,500～3,000文字

## 実例の配置
- 第1節: LOG019, LOG045, LOG051（銀歯脱落）
- 第2節: LOG029, LOG009, LOG041
- 第3節: LOG050
- 第4節: LOG037, LOG051（スーツケース破損）

## 各節のまとめ
- 各節に200～300文字のまとめが必要
EOF
```

**5. 品質基準**:
- ✅ 章のタイトル、構成、分量、各節の内容、実例の配置を確認
- ✅ 確認チェックリストを作成

**6. 完了条件**:
- ✅ 確認チェックリストが作成されている
- ✅ すべての項目が確認されている

**7. 次タスク**: 3.5.3.1 プロンプト作成

---

#### SOP-3.5.4.6: 7観点レビュー

**1. タスク名**: 3.5.4.6 7観点レビュー

**2. 目的**: 修正版2を7つの観点でレビューし、品質を確保する

**3. 前提条件**:
- ✅ 3.5.4.5 レビュー対応・修正2 が完了している
- ✅ 修正版2（chapter5_draft_v3.md）が存在する
- ✅ 詳細設計書最終版（chapter5_detailed_design_v3.md）が存在する

**4. 実施手順**:

**ステップ1**: 事前チェックリストを実行
```bash
python3 /home/ubuntu/ai_travel_book_project/tools/pre_task_checklist.py 3.5.4.6
```

**ステップ2**: 7観点レビューを実施

**観点1: トレーサビリティ**
- すべての実例が実際のログに基づいているか
- 創作や推測がないか

**観点2: 論理性**
- 論理的な流れが明確か
- 矛盾がないか

**観点3: 読みやすさ**
- 読者にとって読みやすいか
- 専門用語に説明があるか

**観点4: 実用性**
- 読者が実践できる内容か
- 具体的な手順が記載されているか

**観点5: 独自性**
- 独自の視点や価値があるか
- 他の書籍との差別化ができているか

**観点6: 文体の一貫性**
- 全章で文体が一貫しているか
- 引用ブロック形式が統一されているか

**観点7: 詳細設計書との照合**
- 章のタイトルが一致しているか
- 章の構成が一致しているか
- 分量が基準を満たしているか
- 各節の内容が一致しているか
- 実例の配置が一致しているか
- 各節のまとめが存在するか

**ステップ3**: 自動検証ツールを実行
```bash
python3 /home/ubuntu/ai_travel_book_project/tools/verify_chapter_against_design.py \
  --chapter /home/ubuntu/ai_travel_book_project/drafts/chapter5_draft_v3.md \
  --design /home/ubuntu/ai_travel_book_project/planning/detailed_designs/chapter5_detailed_design_v3.md \
  --output /home/ubuntu/ai_travel_book_project/reviews/chapter5_verification_report.md
```

**ステップ4**: レビュー報告書3を作成
```bash
cat > /home/ubuntu/ai_travel_book_project/reviews/chapter5_7aspects_review.md << 'EOF'
# 第5章 7観点レビュー報告書

## 観点1: トレーサビリティ
- 評価: ✅ / ⚠️ / ❌
- コメント: ...

## 観点2: 論理性
- 評価: ✅ / ⚠️ / ❌
- コメント: ...

...（以下略）

## 観点7: 詳細設計書との照合
- 評価: ✅ / ⚠️ / ❌
- コメント: ...
- 自動検証ツールの結果: /home/ubuntu/ai_travel_book_project/reviews/chapter5_verification_report.md
EOF
```

**5. 品質基準**:
- ✅ 7観点すべてがレビューされている
- ✅ 詳細設計書との照合が実施されている
- ✅ 自動検証ツールが実行されている

**6. 完了条件**:
- ✅ レビュー報告書3が作成されている
- ✅ すべての観点が評価されている
- ✅ 自動検証ツールの結果が添付されている

**7. 次タスク**: 3.5.4.7 最終修正

---

## 6. 実装計画

### 6-1. 実装するツール

1. **事前チェックリストツール** (`pre_task_checklist.py`)
   - WBS v9から各タスクのインプットを自動抽出
   - インプットファイルの存在確認
   - チェック結果をMarkdownファイルとして出力

2. **自動検証ツール** (`verify_chapter_against_design.py`)
   - 詳細設計書との照合
   - 章のタイトル、構成、分量、各節の内容、実例の配置、各節のまとめの確認
   - 検証結果をMarkdownファイルとして出力

3. **SOP実行ツール** (`run_sop.py`)
   - SOPを読み込み、ステップバイステップで実行
   - 各ステップの完了を確認
   - 次のステップに進む前に、完了条件を満たしているか確認

### 6-2. 実装の優先順位

**優先度1**: 自動検証ツール (`verify_chapter_against_design.py`)
- 第5章の再執筆で即座に使用できる
- 詳細設計書との齟齬を自動検出

**優先度2**: 事前チェックリストツール (`pre_task_checklist.py`)
- 第6章以降の執筆で使用
- WBS違反を事前に防ぐ

**優先度3**: SOP実行ツール (`run_sop.py`)
- 長期的な品質向上のため
- 全タスクの標準化

### 6-3. 実装工数

- 自動検証ツール: 1時間
- 事前チェックリストツール: 0.5時間
- SOP実行ツール: 1時間
- SOP作成（全タスク）: 4時間

**合計**: 6.5時間

---

## 7. 第5章での実証

第5章の再執筆で、以下の仕組みを実証します:

1. **詳細設計書の確認**（SOP-3.5.3.0）を実施
2. **自動検証ツール**を使用して、詳細設計書との照合を実施
3. **7観点レビュー**（SOP-3.5.4.6）を実施

**期待される効果**:
- 詳細設計書との齟齬を早期に検出
- WBS違反を防ぐ
- 高品質な原稿を作成

---

## 8. まとめ

### 8-1. WBS準拠を保証する仕組み

1. **事前チェックリスト**: タスク開始前にインプットを確認
2. **自動検証ツール**: タスク完了後に品質基準を自動検証
3. **SOP**: タスクの実施手順を明文化

### 8-2. 実装計画

1. 自動検証ツールを作成（優先度1）
2. 第5章の再執筆で実証
3. 事前チェックリストツールを作成（優先度2）
4. 第6章以降の執筆で使用

### 8-3. 期待される効果

- WBS違反を防ぐ
- 詳細設計書との齟齬を早期に検出
- 高品質な原稿を作成
- 一貫した品質基準の適用

---

**作成日時**: 2025年11月25日  
**作成者**: AI（Manus）
